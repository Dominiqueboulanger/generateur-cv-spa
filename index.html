<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur de CV Professionnel - SAP</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #3498db; --dark: #2c3e50; --bg: #f4f7f6; --success: #27ae60; }
        body { font-family: 'Montserrat', sans-serif; background-color: var(--bg); color: var(--dark); max-width: 800px; margin: 0 auto; padding: 20px; }
        .section { background: white; border-radius: 8px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h1 { text-align: center; font-weight: 700; color: var(--dark); font-size: 1.5em; }
        h2 { border-left: 5px solid var(--primary); padding-left: 15px; margin-bottom: 15px; font-size: 1.1em; text-transform: uppercase; color: var(--primary); }
        h3 { font-size: 1em; margin-top: 15px; color: var(--dark); border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .btn-group { display: flex; gap: 10px; margin-bottom: 20px; }
        .btn-group button { flex: 1; padding: 12px; cursor: pointer; border: none; border-radius: 4px; color: white; font-weight: bold; transition: 0.3s; }
        .btn-export { background: var(--dark); }
        .btn-import { background: #9b59b6; }
        .btn-generate { background-color: var(--success); color: white; width: 100%; padding: 20px; border: none; font-weight: 700; font-size: 1.2em; cursor: pointer; border-radius: 8px; margin-top: 20px; box-shadow: 0 4px 10px rgba(39, 174, 96, 0.3); }
        .photo-container { display: flex; gap: 20px; align-items: center; margin-bottom: 20px; }
        #photo-preview { width: 100px; height: 120px; border: 2px dashed #ddd; object-fit: cover; border-radius: 5px; background: #eee; }
        input[type="text"], input[type="email"], textarea, select { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-family: 'Montserrat', sans-serif; font-size: 0.9em; }
        textarea { height: 70px; resize: vertical; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .checkbox-label { display: flex; align-items: center; margin: 8px 0; font-weight: 400; cursor: pointer; font-size: 0.9em; }
        .checkbox-label input { margin-right: 10px; transform: scale(1.1); }
        .exp-block { background: #fdfdfd; border: 1px solid #eee; padding: 12px; border-radius: 6px; margin-bottom: 10px; }
        .matiere-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; background: #f0f0f0; padding: 4px 8px; border-radius: 4px; font-size: 0.8em; }
        .add-btn { background: var(--primary); color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; margin-top: 5px; width: 100%; font-weight: bold; font-size: 0.9em; }
        .btn-del { cursor:pointer; color:red; font-weight:bold; margin-left:10px; }
    </style>
</head>
<body onload="loadData()">

    <h1>G√©n√©rateur de CV Professionnel</h1>

    <div class="section">
        <div class="btn-group">
            <button class="btn-export" onclick="exporterJSON()">üíæ Sauvegarder mon travail</button>
            <button class="btn-import" onclick="document.getElementById('fileInput').click()">üìÇ Charger un fichier</button>
            <input type="file" id="fileInput" style="display:none" accept=".json" onchange="importerJSON(event)">
        </div>
    </div>

    <form id="cvForm">
        <div class="section">
            <h2>0. M√©tier vis√©</h2>
            <select name="metier_cible" id="select-metier-cible" onchange="changerMetier()" style="border: 2px solid var(--primary); font-weight: 600;">
                <option value="">-- S√©lectionnez le m√©tier cibl√© --</option>
                <option value="ADVD">Assistant de Vie aux D√©pendances (ADVD)</option>
                <option value="EF">Employ√© familial (EF)</option>
                <option value="Assistant parental">Assistant parental (Garde d'enfants)</option>
            </select>
        </div>

        <div class="section">
            <h2>1. Mes Coordonn√©es</h2>
            <div class="photo-container">
                <img id="photo-preview" src="" alt="Aper√ßu">
                <div style="flex:1">
                    <label>Photo de profil :</label>
                    <input type="file" id="photo-input" accept="image/*" onchange="handlePhoto(event)">
                    <input type="hidden" name="photo_base64" id="photo_base64">
                </div>
            </div>
            <div class="grid-2">
                <input type="text" name="nom" placeholder="Nom et Pr√©nom" oninput="saveData()">
                <input type="text" name="telephone" placeholder="T√©l√©phone" oninput="saveData()">
            </div>
            <input type="email" name="email" placeholder="Email" oninput="saveData()">
            <input type="text" name="ville" placeholder="Ville" oninput="saveData()">
            <div class="grid-2">
                <label class="checkbox-label"><input type="checkbox" name="permis" onchange="saveData()"> Permis B</label>
                <label class="checkbox-label"><input type="checkbox" name="vehicule" onchange="saveData()"> V√©hicul√©(e)</label>
            </div>
        </div>

        <div class="section">
            <h2>2. Mon Profil</h2>
            <textarea name="profil" placeholder="Ex: Professionnelle de l'aide √† domicile avec une solide formation..." oninput="saveData()"></textarea>
        </div>

        <div class="section">
            <h2>3. Exp√©riences Professionnelles</h2>
            <div id="exp-container"></div>
        </div>

        <div class="section">
            <h2>4. Mes Comp√©tences</h2>
            <div class="grid-2">
                <div>
                    <h3>Techniques</h3>
                    <select id="select-tech" onchange="toggleAutre('tech')">
                        <option value="">-- Choisissez un m√©tier d'abord --</option>
                    </select>
                    <input type="text" id="comp-tech-autre" style="display:none" placeholder="Autre comp√©tence">
                    <button type="button" onclick="ajouterCompetence('tech')" class="add-btn">+ Ajouter</button>
                    <div id="comp-tech-list" style="margin-top:10px;"></div>
                </div>
                <div>
                    <h3>Savoir-√™tre</h3>
                    <select id="select-hum" onchange="toggleAutre('hum')">
                        <option value="">-- S√©lectionner --</option>
                        <option value="Empathie et √©coute">Empathie et √©coute</option>
                        <option value="Patience et adaptabilit√©">Patience et adaptabilit√©</option>
                        <option value="Discr√©tion professionnelle">Discr√©tion professionnelle</option>
                        <option value="Sens de l'organisation">Sens de l'organisation</option>
                        <option value="Ponctualit√©">Ponctualit√©</option>
                        <option value="autre">Autre...</option>
                    </select>
                    <input type="text" id="comp-hum-autre" style="display:none" placeholder="Autre savoir-√™tre">
                    <button type="button" onclick="ajouterCompetence('hum')" class="add-btn">+ Ajouter</button>
                    <div id="comp-hum-list" style="margin-top:10px;"></div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>5. Formation</h2>
            <div class="exp-block">
                <strong>Dipl√¥me ou Titre vis√©</strong>
                <input type="text" name="form1_titre" placeholder="Ex: Titre Professionnel ADVF" oninput="saveData()">
                <div class="grid-2">
                    <input type="text" name="form1_annee" placeholder="Ann√©e" oninput="saveData()">
                    <input type="text" name="form1_organisme" placeholder="Organisme (ex: ARITAS)" oninput="saveData()">
                </div>
                <div id="form1-matieres-list" style="margin-top:10px;"></div>
                <div class="grid-2">
                    <select id="select-matiere-suggeree" onchange="copierMatiere()">
                        <option value="">-- Mati√®res sugg√©r√©es --</option>
                    </select>
                    <input type="text" id="form1-nouvelle-matiere" placeholder="Mati√®re personnalis√©e">
                </div>
                <button type="button" class="add-btn" style="background:#95a5a6" onclick="ajouterMatiere(1)">+ Valider la mati√®re</button>
            </div>
        </div>

        <div class="section">
            <h2>6. Langues & Informatique</h2>
            <div class="grid-2">
                <input type="text" name="langues" placeholder="Langues" oninput="saveData()">
                <input type="text" name="informatique" placeholder="Informatique" oninput="saveData()">
            </div>
        </div>

        <div class="section">
            <h2>7. Divers & R√©f√©rences</h2>
            <textarea name="interet" placeholder="Centres d'int√©r√™t..." oninput="saveData()"></textarea>
            <textarea name="references" placeholder="R√©f√©rences (Contacts employeurs)" oninput="saveData()"></textarea>
        </div>
    </form>

    <button class="btn-generate" onclick="genererCV()">‚ú® G√âN√âRER MON CV EN PDF</button>

    <script>
        const baseMetiers = {
            "ADVD": {
                "techniques": [
                    "Aider une personne √† s'asseoir ou se lever en toute s√©curit√©",
                    "Aider √† la toilette intime avec respect et discr√©tion",
                    "Rappeler √† une personne de prendre ses m√©dicaments √† l'heure",
                    "Installer un fauteuil roulant ou une canne de mani√®re s√©curis√©e",
                    "Changer les draps d'un lit m√©dicalis√© avec aide",
                    "Prendre la temp√©rature avec un thermom√®tre frontal",
                    "Stimuler une personne par des activit√©s simples (lecture, musique)",
                    "Utiliser un d√©ambulateur ou aide technique √† la marche",
                    "Les Gestes qui sauvent (Certificat SST)",
                    "Servir un repas en respectant les consignes (mix√©, coup√©)"
                ],
                "matieres": [
                    "Vieillissement et d√©pendance",
                    "Accompagnement quotidien des adultes en perte d'autonomie",
                    "Accompagnement holistique et activit√©s √©panouissantes",
                    "Nutrition s√©nior : Cuisine sur mesure et √©quilibre",
                    "Inclusion active et besoins sp√©cifiques des personnes √¢g√©es"
                ]
            },
            "EF": {
                "techniques": [
                    "Passer l'aspirateur sans oublier les recoins",
                    "Laver et essorer le linge √† la main ou en machine",
                    "Nettoyer les vitres avec un produit adapt√©",
                    "Utiliser un balai et une serpilli√®re pour nettoyer le sol",
                    "Repasser des v√™tements avec un fer √† repasser",
                    "Faire les lits en respectant les r√®gles de propret√©",
                    "Ranger les courses dans les placards ou le r√©frig√©rateur",
                    "Pr√©parer un repas simple (salade, sandwich)",
                    "Pr√©parer une liste de courses pour la semaine",
                    "Utiliser un produit d√©sinfectant pour les sanitaires"
                ],
                "matieres": [
                    "Vieillissement et d√©pendance",
                    "Accompagnement quotidien des adultes en perte d'autonomie",
                    "Accompagnement holistique et activit√©s √©panouissantes",
                    "Nutrition s√©nior : Cuisine sur mesure et √©quilibre",
                    "Inclusion active et besoins sp√©cifiques (handicap/vieillissement)"
                ]
            },
            "Assistant parental": {
                "techniques": [
                    "Pr√©parer un biberon en respectant les doses et l'hygi√®ne",
                    "Changer une couche en suivant les √©tapes d'hygi√®ne",
                    "Habiller un enfant en adaptant les v√™tements √† la m√©t√©o",
                    "Donner un bain √† un b√©b√© sous supervision",
                    "St√©riliser les biberons et les t√©tines",
                    "Organiser des jeux adapt√©s √† l'√¢ge de l'enfant",
                    "R√©chauffer un repas en respectant les consignes de s√©curit√©",
                    "Installer un enfant dans un si√®ge auto ou poussette",
                    "Reconna√Ætre les signes de fatigue ou de faim",
                    "D√©sinfecter les jouets et les surfaces de jeu"
                ],
                "matieres": [
                    "Une formation compl√®te pour l‚Äôaccompagnement individualis√© de l‚Äôenfant",
                    "Accompagner l‚Äôenfant dans son voyage d‚Äôapprentissages",
                    "Cultiver le savoir de l‚Äôenfant par le jeu et la cr√©ativit√©",
                    "Approche globale de l‚Äôalimentation ‚Äì de la petite enfance √† l‚Äôadolescence",
                    "Inclusion active et accompagnement des enfants √† besoins sp√©cifiques"
                ]
            }
        };

        const troncCommun = [
            "Multi-emploi ‚Äì Ma√Ætrise et gestion de sa carri√®re",
            "Pr√©vention et premiers secours au domicile",
            "Gestion du domicile, entretien √©coresponsable et soin du vivant",
            "Unis dans l'action : Coordonner, organiser et collaborer"
        ];

        let competencesTech = [];
        let competencesHum = [];
        let matieres = { 1: [] };

        function changerMetier() {
            const metier = document.getElementById('select-metier-cible').value;
            const selectTech = document.getElementById('select-tech');
            const selectMat = document.getElementById('select-matiere-suggeree');
            selectTech.innerHTML = '<option value="">-- Choisir une comp√©tence --</option>';
            selectMat.innerHTML = '<option value="">-- Mati√®res sugg√©r√©es --</option>';
            troncCommun.forEach(m => selectMat.innerHTML += `<option value="${m}">[Tronc] ${m}</option>`);
            if(metier && baseMetiers[metier]) {
                baseMetiers[metier].techniques.forEach(c => selectTech.innerHTML += `<option value="${c}">${c}</option>`);
                baseMetiers[metier].matieres.forEach(m => selectMat.innerHTML += `<option value="${m}">${m}</option>`);
                selectTech.innerHTML += '<option value="autre">Autre...</option>';
                selectMat.innerHTML += '<option value="autre">Autre...</option>';
            }
            saveData();
        }

        function copierMatiere() {
            const sel = document.getElementById('select-matiere-suggeree');
            const inp = document.getElementById('form1-nouvelle-matiere');
            if(sel.value !== "autre" && sel.value !== "") inp.value = sel.value;
            else { inp.value = ""; inp.focus(); }
        }

        const container = document.getElementById('exp-container');
        for(let i=1; i<=3; i++) {
            container.innerHTML += `
                <div class="exp-block">
                    <strong>Exp√©rience ${i}</strong>
                    <input type="text" name="exp${i}_titre" placeholder="Intitul√© du poste" oninput="saveData()">
                    <input type="text" name="exp${i}_dates" placeholder="Dates" oninput="saveData()">
                    <textarea name="exp${i}_missions" placeholder="Missions..." oninput="saveData()"></textarea>
                </div>`;
        }

        function handlePhoto(event) {
            const reader = new FileReader();
            reader.onload = e => {
                document.getElementById('photo-preview').src = e.target.result;
                document.getElementById('photo_base64').value = e.target.result;
                saveData();
            };
            if(event.target.files[0]) reader.readAsDataURL(event.target.files[0]);
        }

        function saveData() {
            const form = new FormData(document.getElementById('cvForm'));
            const data = Object.fromEntries(form.entries());
            data.comp_tech = competencesTech;
            data.comp_hum = competencesHum;
            data.matieres = matieres;
            localStorage.setItem('cv_sap_data_v3', JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem('cv_sap_data_v3');
            if (!saved) return;
            const data = JSON.parse(saved);
            Object.keys(data).forEach(key => {
                const el = document.getElementsByName(key)[0];
                if (el) {
                    if (el.type === 'checkbox') el.checked = data[key] === 'on' || data[key] === true;
                    else el.value = data[key];
                }
            });
            if(data.metier_cible) changerMetier();
            if(data.photo_base64) document.getElementById('photo-preview').src = data.photo_base64;
            competencesTech = data.comp_tech || [];
            competencesHum = data.comp_hum || [];
            matieres = data.matieres || { 1: [] };
            afficherCompetences('tech'); afficherCompetences('hum');
            afficherMatieres(1);
        }

        function ajouterCompetence(type) {
            const sel = document.getElementById(`select-${type}`);
            const aut = document.getElementById(`comp-${type}-autre`);
            const val = sel.value === 'autre' ? aut.value : sel.value;
            if(val) {
                if(type === 'tech') competencesTech.push(val); else competencesHum.push(val);
                saveData(); afficherCompetences(type);
                aut.value = ''; sel.value = ''; aut.style.display = 'none';
            }
        }

        function afficherCompetences(type) {
            const list = type === 'tech' ? competencesTech : competencesHum;
            document.getElementById(`comp-${type}-list`).innerHTML = list.map((c, i) => `
                <div class="matiere-item"><span>${c}</span> <span class="btn-del" onclick="supprimerComp('${type}', ${i})">‚úï</span></div>
            `).join('');
        }

        function supprimerComp(type, index) {
            if(type === 'tech') competencesTech.splice(index, 1); else competencesHum.splice(index, 1);
            saveData(); afficherCompetences(type);
        }

        function toggleAutre(type) {
            document.getElementById(`comp-${type}-autre`).style.display = document.getElementById(`select-${type}`).value === 'autre' ? 'block' : 'none';
        }

        function ajouterMatiere(id) {
            const input = document.getElementById(`form${id}-nouvelle-matiere`);
            if(input.value) { matieres[id].push(input.value); input.value = ''; saveData(); afficherMatieres(id); }
        }

        function afficherMatieres(id) {
            document.getElementById(`form${id}-matieres-list`).innerHTML = matieres[id].map((m, i) => `
                <div class="matiere-item">${m} <span class="btn-del" onclick="matieres[${id}].splice(${i},1); saveData(); afficherMatieres(${id})">‚úï</span></div>
            `).join('');
        }

        function exporterJSON() {
            const blob = new Blob([localStorage.getItem('cv_sap_data_v3')], {type: "application/json"});
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = "sauvegarde_cv.json"; a.click();
        }

        function importerJSON(event) {
            const reader = new FileReader();
            reader.onload = e => { localStorage.setItem('cv_sap_data_v3', e.target.result); loadData(); };
            reader.readAsText(event.target.files[0]);
        }

        function genererCV() {
            const data = JSON.parse(localStorage.getItem('cv_sap_data_v3'));
            const win = window.open('', '_blank');
            win.document.write(`
                <html><head><title>CV - ${data.nom}</title>
                <style>
                    body { font-family: 'Montserrat', sans-serif; padding: 30px; color: #333; line-height: 1.3; }
                    .header { display: flex; align-items: center; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-bottom: 15px; }
                    .photo { width: 85px; height: 105px; border-radius: 4px; margin-right: 20px; object-fit: cover; background: #eee; border: 1px solid #ddd; }
                    h1 { color: #2c3e50; margin: 0; text-transform: uppercase; font-size: 19px; }
                    .metier { color: #3498db; font-weight: bold; font-size: 16px; margin-top: 2px; }
                    h2 { color: #3498db; text-transform: uppercase; font-size: 12.5px; border-bottom: 1px solid #eee; margin-top: 12px; padding-bottom: 3px; margin-bottom: 6px; }
                    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
                    ul { padding-left: 15px; margin: 3px 0; }
                    li { font-size: 11px; margin-bottom: 2px; }
                    p, div { font-size: 11px; margin: 0; }
                    .exp-item { margin-bottom: 8px; }
                </style></head>
                <body>
                    <div class="header">
                        ${data.photo_base64 ? `<img src="${data.photo_base64}" class="photo">` : ''}
                        <div>
                            <h1>${data.nom || 'NOM Pr√©nom'}</h1>
                            <div class="metier">${data.metier_cible || ''}</div>
                            <p>${data.ville} | ${data.telephone} | ${data.email}<br>
                            ${data.permis ? 'Permis B' : ''} ${data.vehicule ? ' - V√©hicul√©(e)' : ''}</p>
                        </div>
                    </div>
                    <h2>Profil Professionnel</h2><p>${data.profil}</p>
                    <h2>Exp√©riences Professionnelles</h2>
                    ${[1,2,3].map(i => data[`exp${i}_titre`] ? `<div class="exp-item"><strong>${data[`exp${i}_titre`]}</strong> (${data[`exp${i}_dates`]})<br><span style="white-space:pre-line">${data[`exp${i}_missions`]}</span></div>` : '').join('')}
                    <div class="grid">
                        <div><h2>Comp√©tences Techniques</h2><ul>${data.comp_tech.map(c => `<li>${c}</li>`).join('')}</ul></div>
                        <div><h2>Savoir-√™tre</h2><ul>${data.comp_hum.map(c => `<li>${c}</li>`).join('')}</ul></div>
                    </div>
                    <h2>Formation</h2>
                    <div><strong>${data.form1_titre}</strong> (${data.form1_annee}) - ${data.form1_organisme}
                    <ul style="margin-top:4px;">${data.matieres[1].map(m=>`<li>${m}</li>`).join('')}</ul></div>
                    <div class="grid">
                        <div><h2>Langues & Informatique</h2><p>${data.langues}<br>${data.informatique}</p></div>
                        <div><h2>Centres d'int√©r√™t</h2><p>${data.interet}</p></div>
                    </div>
                    ${data.references ? `<h2>R√©f√©rences</h2><p style="font-style:italic; font-size:10px;">${data.references}</p>` : ''}
                    <script>setTimeout(() => { window.print(); }, 500);<\/script>
                </body></html>
            `);
        }
    </script>
</body>
</html>
